# TransportVic2
Hi! This is a complete rewrite of TransportVic, now that I've lived in Melbourne for a longer time and actually know the system through.

## Current features:
- Loading in MTM timetables
- Loading in Metropolitan bus timetables
  - Multiple batching rounds in place to optimise memory usage:
  - Repeated I/O preferred over massive 2GB memory usage, currently tops around 800MB
  - Need to add flag for Mac which actually doesn't like batching and likes the big all-at-once method
- Loading in V/Line train timetables
- Loading in Regional coach timetables
- Showing live MTM departures when the services are running as timetabled
- Predicting MTM City Loop configuration when services are running as timetabled
- Show proper destination names for MTM departures that match station announcements
  - RMD/NME/JLI -> FSS -> LOOP show up as Flinders Street services, though the loop config below makes it clear it still pass through the loop on the next trip
  - RMD/NME/JLI -> LOOP -> FSS show as City Loop
- Showing live V/Line departures when the services are running as timetabled
- Showing live V/Line departures when the services are NOT running as timetabled in GTFS, but falling back to NSP Run IDs. Currently no support for updated stopping patterns or stop times
- Showing live V/Line departures when there's completely no timetable match, this plasters warnings all over the departure row
- Showing live MTM departures when there's completely no timetable match (17:02 FSS ex Westall), also plasters warnings on the departure.
- Looks for trips being formed next in City Loop stations, and joins it the the departure stops-at
- Showing Regional coach timetables. Does not consult PTV API for trips as this will get it confused between actual coach trips and train trips.
- Offline mode
- Couple of mockup displays
  - Flinders Street Station escalator displays
  - 7x2 LCD PIDS displays found at suburban stations
- GeoJSON visualiser, cos why not
- Checks disruptions every 10min, currently handles suspensions
  - Finds trips affected by suspension and breaks into 3 - first train leg, bus leg and second train leg.
  - Currently only looks at end stations, should have it check all stations in between for those express services?
- Ability to detect when V/Line trains are scheduled to run as coaches. Currently no support for live disruptions.
- Stop merging in place
  - Roads do not get merged, see commit [0c3cf46](https://github.com/TransportVic/TransportVic2/commit/0c3cf45222eb2d94bc1e26cc6a95b862218a441f)
  - Looks for stops with the same primary stop name: Primary Stop Name/Road Name (Suburb)
  - If the primary stop name matches and the 2 stops are within a set distance, varying for stop types, they are merged.
  - When requesting stop timing data, the "bays" are filtered by mode, then grouped by originalName
    - If online, the first stopGTFSID is taken from each group, and sent to PTV's server
    - Otherwise, eash stopGTFSID is used and a getScheduledDepartures is called, with the results merged.
- Shows trip timings for MTM
  - Includes timetabled train model & relevant icon
  - Show run ID too
    - Specially cross references static TT dump for stony point line. Hardcoded as 2x SP for all services, need to camp out and find those operating as 1x SP
  - Takes the first trip past flinders for down trips - allows it to be clear of the loop forming nonsense and also be able to tell apart the 527 crazyburn service
    - Maybe auto-load all trips seen in a `/departures` load into the Live DB, including run number to help. Then add special code to request stop timings if its a 5.27 towards Craigieburn.
- Shows trip timings for V/Line
  - Includes timetabled train model & relevant icon & run ID
  - No realtime info
- V/Line coach replacement override
  - Apparently PTV doesn't bother programming in some replacement operations into the regional coach thing so to the program it thinks nothing exists for those services
  - Not sure accurate but at least it alerts the user to the disruption in their face, PTV doesn't even outright tell you
  - Also calls up the PTV API cos they're lazy with releasing GTFS dumps meaning that some replacement ops get missed out :( (looking at you albury)

## Next up to be added:
- bus timings
  - same as mtm for impl but without the city loop and short trip stuff
- route view
- Icons for the various stopping pattern pages
  - Completed:
    - EDI Comeng (PTV) (Used for both types)
    - X'Traps (PTV)
    - Siemens (PTV)
    - N Locomotive (Mark 3)
    - Sprinter (Mark 3)
    - Velocity (PTV)
    - Volgren CR228L (PTV/White)
    - Volgren Optimus (PTV/White)
  - To Do:
    - HCMT (PTV)
    - Optare Solo (PTV/White)
    - Coach, need to find a suitable one for drawing
    - Trams (possibly do sideways rather than front?)
      - A1/2
      - B2 (looks the same as A1/2, which is why side)
      - C1
      - C2
      - D1
      - D2
      - E1/2
      - W8
      - Z3
  - Thoughts:
    - Trams will use a simple lookup from the tram number to get the model
    - Buses is difficult, integration with tracker? (needs a way to link block id to actual trips)
      - Lookup bus DB, if bodywork is drawn then show it, otherwise just display fleet number
      - Would really only work with Ventura services
  - Searches up stopping pattern for trips not in any DB
- Refactor all moment.tz to a utils method
- Knowing that showgrounds trains can form Craigieburn (maybe other northern grp too?) services upon reaching the city, helps reduce "unknown trip syndrome"
- Reading English and creating a daily timetable update DB collection, can be used to mark services as coaches / cancelled (V/Line!!) as well as just MTM train types
  - could work with Yarra Trams too, mark tram number
  - but i guess i need to teach it tram models then
- Showing stopping patterns for MTM and V/Line services
  - Show timings and stops most importantly
  - Show Run ID and vehicle type + icon (yay!)
- Do up bus timings pages
- Marking the current completely unknown trips in the live DB, and using more magic to get the stopping patterns for those
- Homepage
- Also find out how to ID replacement services
- Make sure when it says 5:27pm Craigieburn it picks the correct one (maybe using loop heuristics)
- And of course the departure info
  - Look into merging bus stops (Eg. Clayton Railway Station can show both Clayton Road and Carnish Road timings)
  - Merge night bus timings too? Though only merge if its at night LOL
  - Ohno just realised Monash University and Monash University/Wellington Road are different :/
    - maybe add sub headings to clearly id which stop the timings belong to, though this may be confusing
- Then show bus stopping patterns
- And of course trams
- Tram Tracker stop IDs
- Bookmarks
- App mode
- And everything else on TransportVic homepage (which is think there's nothing else)
- Fare calculator thingy
- Regional bus
  - Then show the town too, using suburb -> council/LGA list
  - Eg XXX: Regional Bus Stop in Suburb (Greater Geelong)
- Telebus
  - idk if the damn stop info is still messed up
- Night bus
  - Sorta goes under metropolitan bus but not quite
- Interstate bus
  - wtf is this even
  - do it anyway
- SkyBus
  - ah yes overpriced
- Ferries
- Tourist trains
  - MAKE SURE PUFFING BILLY IS SHOWN LAST
- If disruption thing isn't implemented do a status board
- Auto update of GTFS data?
- Maps
- Weather if I can find a way to do it freely
- Maybe add a gunzel mode: show freight train timetables?? knockoff TRIMS
- At this point its better than PTV * big flex *
- day mode
- SCS arrivals
- Timetable search
- jeez this list is long
- journey planner if it takes the whole 2020 to impl this
- myki manager if it's safe

## Me talking about how it works
Realtime V/Line departures?

-> Does their app do it? Yes, but actually no
