extends ../layout
    
block head
  -
    function processName(name) { return shorternStopName(name.split('/')[0]) }
    let title = `${trip.departureTime} ${processName(trip.origin)} to ${destination}`
    if (trip.routeNumber) {
      title = `${trip.departureTime} ${trip.routeNumber} to ${destination}`
    }
  title=`TransportVic - ${title}`
  
  meta(property='og:title' content=`TransportVic - ${title}`)
  meta(property='twitter:title' content=`TransportVic - ${title}`)
  meta(property='og:description' content=`Viewing the ${title}`)
  meta(property='twitter:description' content=`Viewing the ${title}`)
  -
    switch (trip.mode) {
      case 'bus':
        themeColour = '#d7832c'
        break
      case 'tram':
        themeColour = '#20b734'
        break
      case 'regional coach':
        themeColour = '#9582b5'
        break
      case 'ferry':
        themeColour = '#03998f'
        break
    }
    
    
block title
  span=title
  
block style
  link(rel='stylesheet' href='/static/css/timings/base-style.css')
  link(rel='stylesheet' href='/static/css/combined-colours.css')
  link(rel='stylesheet' href='/static/css/runs/base-style.css')
  link(rel='stylesheet' href='/static/css/runs/trains.css')

block content
  if trip.vehicleData
    div.infoRow
      span=trip.vehicleData.name
      div.vehicle
        //- placeholder icon
        span
        img(src=`/static/images/icons/optimus.svg`)
  - let hasNumber = !!trip.routeNumber
  div(class=`departure${hasNumber ? '' : ' no-number'}`)
    if hasNumber
      a(class=`leftContainer platform ${operator}`)
        if loopDirection
          span.topText=loopDirection
        else if trip.routeDetails
          span.topText=trip.routeDetails
        span.bigNumber=trip.routeNumber
    a.departureInfo
      if !hasNumber
        span.routeName=trip.routeName
      span.towards Towards
      span.destination=destination
      if viaText && hasNumber
        span.info.smaller=viaText
      if trip.cancelled
        span.info.cancelled CANCELLED
  div.infoRow
    span Bus stop
  div.timing-list
    for stop in trip.stopTimings
      div.timingRow(id='stop-' + stop.stopGTFSID)
        a.departureInfo
          -
            let stopParts = stop.stopName.split('/')
            let stopRoad, stopName
            if (stopParts.length === 2) {
              stopName = stopParts[0]
              stopRoad = stopParts[1]
            } else {
              if (stopParts = stop.stopName.match(/^(\d+) (.+)$/)) {
                stopRoad = stopParts[2]
                stopName = stopParts[1] + ' ' + stopRoad
              } else {
                stopName = stop.stopName
                stopRoad = ''
              }
            }
          span.stopRoad=stopRoad
          -
            let displayName = stopName
            if (stop.stopNumber)
              displayName += ` #${stop.stopNumber}`
          span.stopName=displayName
        div(class=`timing ${stop.headwayDevianceClass}`)
          span=stop.prettyTimeToArrival
          span=stop.departureTime || stop.arrivalTime
